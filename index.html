<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>求职助手</title>
  
  <!-- 引入外部资源 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
  <!-- 引入SheetJS库用于Excel处理 -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  
  <!-- Tailwind 配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#3B82F6', // 蓝色作为主色调，代表专业和信任
            status: {
              applied: '#60A5FA', // 投递
              interview1: '#34D399', // 一面
              interview2: '#10B981', // 二面
              interview3: '#059669', // 三面
              interview4: '#047857', // 四面
              hr: '#F59E0B', // HR面
              rejected: '#EF4444' // 挂了
            }
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <!-- 自定义工具类 -->
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .card-shadow {
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }
      .card-hover {
        transition: all 0.3s ease;
      }
      .card-hover:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      }
      .modal-transition {
        transition: transform 0.2s ease-in-out;
      }
    }
  </style>
</head>
<body class="bg-gray-50 font-sans">
  <!-- 顶部导航栏 -->
  <header class="bg-white shadow-md sticky top-0 z-50">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
      <div class="flex items-center space-x-2">
        <i class="fa fa-briefcase text-primary text-2xl"></i>
        <h1 class="text-[clamp(1.5rem,3vw,2rem)] font-bold text-gray-800">秋招求职助手</h1>
      </div>
      <div class="flex items-center space-x-3">
        <button id="importExcelBtn" class="bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 rounded-lg transition-all flex items-center shadow-md hover:shadow-lg">
          <i class="fa fa-upload mr-2"></i>导入Excel
        </button>
        <button id="exportExcelBtn" class="bg-purple-500 hover:bg-purple-600 text-white font-medium py-2 px-4 rounded-lg transition-all flex items-center shadow-md hover:shadow-lg">
          <i class="fa fa-download mr-2"></i>导出Excel
        </button>
        <button id="addCompanyBtn" class="bg-primary hover:bg-primary/90 text-white font-medium py-2 px-4 rounded-lg transition-all flex items-center shadow-md hover:shadow-lg">
          <i class="fa fa-plus mr-2"></i>添加公司
        </button>
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 py-8">
    <!-- 统计和筛选区域 -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
      <!-- 统计卡片 -->
      <div class="bg-white rounded-xl shadow p-6 col-span-1 transform transition-all duration-300 hover:shadow-lg">
        <h2 class="text-xl font-semibold text-gray-800 mb-4">投递统计</h2>
        <div class="h-64">
          <canvas id="statusChart"></canvas>
        </div>
        <div class="grid grid-cols-2 sm:grid-cols-3 gap-2 mt-4">
          <div class="flex items-center">
            <span class="w-3 h-3 rounded-full bg-status-applied mr-2"></span>
            <span class="text-sm text-gray-600">已投递</span>
          </div>
          <div class="flex items-center">
            <span class="w-3 h-3 rounded-full bg-status-interview1 mr-2"></span>
            <span class="text-sm text-gray-600">一面</span>
          </div>
          <div class="flex items-center">
            <span class="w-3 h-3 rounded-full bg-status-interview2 mr-2"></span>
            <span class="text-sm text-gray-600">二面</span>
          </div>
          <div class="flex items-center">
            <span class="w-3 h-3 rounded-full bg-status-interview3 mr-2"></span>
            <span class="text-sm text-gray-600">三面</span>
          </div>
          <div class="flex items-center">
            <span class="w-3 h-3 rounded-full bg-status-interview4 mr-2"></span>
            <span class="text-sm text-gray-600">四面</span>
          </div>
          <div class="flex items-center">
            <span class="w-3 h-3 rounded-full bg-status-hr mr-2"></span>
            <span class="text-sm text-gray-600">HR面</span>
          </div>
          <div class="flex items-center col-span-2 sm:col-span-1">
            <span class="w-3 h-3 rounded-full bg-status-rejected mr-2"></span>
            <span class="text-sm text-gray-600">已挂</span>
          </div>
        </div>
      </div>
      
      <!-- 筛选和排序 -->
      <div class="bg-white rounded-xl shadow p-6 col-span-1 lg:col-span-2 transform transition-all duration-300 hover:shadow-lg">
        <h2 class="text-xl font-semibold text-gray-800 mb-4">筛选与排序</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">投递状态</label>
            <div class="flex flex-wrap gap-2">
              <button class="status-filter px-3 py-1 rounded-full bg-gray-100 hover:bg-gray-200 text-sm transition-all ring-2 ring-primary/50" data-status="all">全部</button>
              <button class="status-filter px-3 py-1 rounded-full bg-status-applied/20 hover:bg-status-applied/30 text-status-applied text-sm transition-all" data-status="applied">已投递</button>
              <button class="status-filter px-3 py-1 rounded-full bg-status-interview1/20 hover:bg-status-interview1/30 text-status-interview1 text-sm transition-all" data-status="interview1">一面</button>
              <button class="status-filter px-3 py-1 rounded-full bg-status-interview2/20 hover:bg-status-interview2/30 text-status-interview2 text-sm transition-all" data-status="interview2">二面</button>
              <button class="status-filter px-3 py-1 rounded-full bg-status-interview3/20 hover:bg-status-interview3/30 text-status-interview3 text-sm transition-all" data-status="interview3">三面</button>
              <button class="status-filter px-3 py-1 rounded-full bg-status-interview4/20 hover:bg-status-interview4/30 text-status-interview4 text-sm transition-all" data-status="interview4">四面</button>
              <button class="status-filter px-3 py-1 rounded-full bg-status-hr/20 hover:bg-status-hr/30 text-status-hr text-sm transition-all" data-status="hr">HR面</button>
              <button class="status-filter px-3 py-1 rounded-full bg-status-rejected/20 hover:bg-status-rejected/30 text-status-rejected text-sm transition-all" data-status="rejected">已挂</button>
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">排序方式</label>
            <div class="flex flex-wrap gap-2">
              <button id="sortByDateAsc" class="px-3 py-1 rounded-full bg-gray-100 hover:bg-gray-200 text-sm transition-all flex items-center ring-2 ring-primary/50">
                <i class="fa fa-calendar-o mr-1"></i> 面试时间最早
              </button>
              <button id="sortByDateDesc" class="px-3 py-1 rounded-full bg-gray-100 hover:bg-gray-200 text-sm transition-all flex items-center">
                <i class="fa fa-calendar mr-1"></i> 面试时间最晚
              </button>
            </div>
          </div>
        </div>
        
        <div class="mt-4 flex justify-between items-center">
          <div class="text-gray-600">
            共 <span id="totalCount" class="font-semibold">0</span> 条记录
          </div>
          <button id="clearAllBtn" class="text-gray-500 hover:text-gray-700 text-sm transition-all flex items-center">
            <i class="fa fa-trash-o mr-1"></i> 清空所有记录
          </button>
        </div>
      </div>
    </div>
    
    <!-- 公司列表 -->
    <div id="companyList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <!-- 公司卡片将通过JavaScript动态生成 -->
      <div class="col-span-full flex justify-center items-center py-16 text-gray-500">
        <div class="text-center">
          <i class="fa fa-file-text-o text-5xl mb-4 opacity-30"></i>
          <p>还没有添加任何公司记录</p>
          <p class="mt-2">点击"添加公司"按钮开始记录你的秋招历程</p>
        </div>
      </div>
    </div>
  </main>
  
  <!-- 添加/编辑公司的模态框 -->
  <div id="companyModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
    <div class="bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto modal-transition scale-95">
      <div class="p-6 border-b">
        <div class="flex justify-between items-center">
          <h2 id="modalTitle" class="text-xl font-bold text-gray-800">添加公司记录</h2>
          <button id="closeModalBtn" class="text-gray-500 hover:text-gray-700 transition-colors">
            <i class="fa fa-times text-xl"></i>
          </button>
        </div>
      </div>
      
      <form id="companyForm" class="p-6 space-y-4">
        <input type="hidden" id="companyId">
        
        <div>
          <label for="companyName" class="block text-sm font-medium text-gray-700 mb-1">公司名称 <span class="text-red-500">*</span></label>
          <input type="text" id="companyName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all outline-none" required>
        </div>
        
        <div>
          <label for="status" class="block text-sm font-medium text-gray-700 mb-1">投递状态 <span class="text-red-500">*</span></label>
          <select id="status" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all outline-none" required>
            <option value="applied">已投递</option>
            <option value="interview1">一面</option>
            <option value="interview2">二面</option>
            <option value="interview3">三面</option>
            <option value="interview4">四面</option>
            <option value="hr">HR面</option>
            <option value="rejected">已挂</option>
          </select>
        </div>
        
        <div>
          <label for="interviewTime" class="block text-sm font-medium text-gray-700 mb-1">面试时间</label>
          <input type="datetime-local" id="interviewTime" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all outline-none">
        </div>
        
        <div>
          <label for="interviewLink" class="block text-sm font-medium text-gray-700 mb-1">面试网址链接</label>
          <input type="url" id="interviewLink" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all outline-none" placeholder="https://...">
        </div>
        
        <div>
          <label for="summary" class="block text-sm font-medium text-gray-700 mb-1">总结</label>
          <textarea id="summary" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all outline-none" placeholder="记录面试内容、问题等"></textarea>
        </div>
        
        <div>
          <label for="summaryLink" class="block text-sm font-medium text-gray-700 mb-1">总结链接</label>
          <input type="url" id="summaryLink" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all outline-none" placeholder="如笔记链接、文档链接等">
        </div>
        
        <div class="flex justify-end gap-3 pt-4 border-t">
          <button type="button" id="cancelBtn" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-all">取消</button>
          <button type="submit" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-all shadow hover:shadow-md">保存</button>
        </div>
      </form>
    </div>
  </div>
    <!-- 隐藏的文件输入用于导入Excel -->
  <input type="file" id="excelFileInput" accept=".xlsx,.xls" class="hidden">
  <script>
    // 状态文本映射
    const statusTextMap = {
      'applied': '已投递',
      'interview1': '一面',
      'interview2': '二面',
      'interview3': '三面',
      'interview4': '四面',
      'hr': 'HR面',
      'rejected': '已挂'
    };
    
    // 状态颜色映射
    const statusColorMap = {
      'applied': 'bg-status-applied',
      'interview1': 'bg-status-interview1',
      'interview2': 'bg-status-interview2',
      'interview3': 'bg-status-interview3',
      'interview4': 'bg-status-interview4',
      'hr': 'bg-status-hr',
      'rejected': 'bg-status-rejected'
    };
    
    // 初始化数据 - 从本地存储读取或使用空数组
    let companies = JSON.parse(localStorage.getItem('autumnRecruitmentCompanies')) || [];
    let currentFilter = 'all';
    let sortOrder = 'asc'; // 'asc' 或 'desc'
    
    // DOM 元素
    const companyListEl = document.getElementById('companyList');
    const addCompanyBtn = document.getElementById('addCompanyBtn');
    const exportExcelBtn = document.getElementById('exportExcelBtn');
    const importExcelBtn = document.getElementById('importExcelBtn');
    const companyModal = document.getElementById('companyModal');
    const closeModalBtn = document.getElementById('closeModalBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    const companyForm = document.getElementById('companyForm');
    const modalTitle = document.getElementById('modalTitle');
    const statusFilters = document.querySelectorAll('.status-filter');
    const sortByDateAsc = document.getElementById('sortByDateAsc');
    const sortByDateDesc = document.getElementById('sortByDateDesc');
    const totalCountEl = document.getElementById('totalCount');
    const clearAllBtn = document.getElementById('clearAllBtn');
    
    // 初始化图表
    let statusChart;
    
    // 初始化应用
    function initApp() {
      // 尝试从Excel导入数据，如果没有Excel则使用localStorage
      importFromExcelOnLoad();
      renderCompanyList();
      updateTotalCount();
      initStatusChart();
      setupEventListeners();
    }
    
    // 设置事件监听器
    function setupEventListeners() {
      // 添加公司按钮
      addCompanyBtn.addEventListener('click', () => {
        openModal();
      });

      // 导出Excel按钮
      exportExcelBtn.addEventListener('click', exportToExcel);

      // 导入Excel按钮
      importExcelBtn.addEventListener('click', () => {
        document.getElementById('excelFileInput').click();
      });

      // 监听文件选择
      document.getElementById('excelFileInput').addEventListener('change', handleExcelFileSelect);
      
      // 关闭模态框
      closeModalBtn.addEventListener('click', closeModal);
      cancelBtn.addEventListener('click', closeModal);
      
      // 点击模态框外部关闭
      companyModal.addEventListener('click', (e) => {
        if (e.target === companyModal) {
          closeModal();
        }
      });
      
      // 提交表单
      companyForm.addEventListener('submit', (e) => {
        e.preventDefault();
        saveCompany();
      });
      
      // 状态筛选
      statusFilters.forEach(btn => {
        btn.addEventListener('click', () => {
          // 更新活跃状态
          statusFilters.forEach(b => b.classList.remove('ring-2', 'ring-primary/50'));
          btn.classList.add('ring-2', 'ring-primary/50');
          
          currentFilter = btn.dataset.status;
          renderCompanyList();
        });
      });
      
      // 排序
      sortByDateAsc.addEventListener('click', () => {
        sortOrder = 'asc';
        renderCompanyList();
        sortByDateAsc.classList.add('ring-2', 'ring-primary/50');
        sortByDateDesc.classList.remove('ring-2', 'ring-primary/50');
      });
      
      sortByDateDesc.addEventListener('click', () => {
        sortOrder = 'desc';
        renderCompanyList();
        sortByDateDesc.classList.add('ring-2', 'ring-primary/50');
        sortByDateAsc.classList.remove('ring-2', 'ring-primary/50');
      });
      
      // 清空所有记录
      clearAllBtn.addEventListener('click', () => {
        if (companies.length > 0 && confirm('确定要清空所有记录吗？此操作不可恢复！')) {
          companies = [];
          saveToLocalStorage();
          renderCompanyList();
          updateTotalCount();
          updateStatusChart();
        }
      });
    }
    
    // 打开模态框
    function openModal(company = null) {
      // 重置表单
      companyForm.reset();
      document.getElementById('companyId').value = '';
      
      if (company) {
        // 编辑模式
        modalTitle.textContent = `编辑 ${company.name} 记录`;
        document.getElementById('companyId').value = company.id;
        document.getElementById('companyName').value = company.name;
        document.getElementById('status').value = company.status;
        document.getElementById('interviewTime').value = company.interviewTime || '';
        document.getElementById('interviewLink').value = company.interviewLink || '';
        document.getElementById('summary').value = company.summary || '';
        document.getElementById('summaryLink').value = company.summaryLink || '';
      } else {
        // 添加模式
        modalTitle.textContent = '添加公司记录';
      }
      
      companyModal.classList.remove('hidden');
      // 添加动画效果
      setTimeout(() => {
        companyModal.querySelector('.modal-transition').classList.add('scale-100');
        companyModal.querySelector('.modal-transition').classList.remove('scale-95');
      }, 10);
    }

    // 导出数据到Excel
    function exportToExcel() {
      if (companies.length === 0) {
        alert('没有数据可导出');
        return;
      }

      // 准备导出数据
      const exportData = companies.map(company => ({
        '公司名称': company.name,
        '投递状态': statusTextMap[company.status],
        '面试时间': company.interviewTime ? formatDateTime(company.interviewTime) : '',
        '面试网址': company.interviewLink || '',
        '总结': company.summary || '',
        '总结链接': company.summaryLink || '',
        '创建时间': formatDateTime(company.createdAt)
      }));

      // 创建工作簿和工作表
      const ws = XLSX.utils.json_to_sheet(exportData);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, '秋招记录');

      // 导出Excel文件
      XLSX.writeFile(wb, '秋招求职记录.xlsx');
    }

    // 处理Excel文件选择
    function handleExcelFileSelect(e) {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = new Uint8Array(e.target.result);
          const workbook = XLSX.read(data, { type: 'array' });
          const worksheet = workbook.Sheets[workbook.SheetNames[0]];
          const jsonData = XLSX.utils.sheet_to_json(worksheet);

          // 转换导入的数据
          const importedCompanies = jsonData.map(item => {
            // 查找状态对应的键
            let statusKey = 'applied';
            Object.entries(statusTextMap).forEach(([key, value]) => {
              if (value === item['投递状态']) {
                statusKey = key;
              }
            });

            return {
              id: Date.now().toString() + Math.floor(Math.random() * 1000),
              name: item['公司名称'] || '',
              status: statusKey,
              interviewTime: item['面试时间'] ? new Date(item['面试时间']).toISOString() : '',
              interviewLink: item['面试网址'] || '',
              summary: item['总结'] || '',
              summaryLink: item['总结链接'] || '',
              createdAt: item['创建时间'] ? new Date(item['创建时间']).toISOString() : new Date().toISOString()
            };
          });

          // 确认是否替换现有数据
          if (confirm(`发现${importedCompanies.length}条记录，是否替换现有数据？`)) {
            companies = importedCompanies;
            saveToLocalStorage();
            renderCompanyList();
            updateTotalCount();
            updateStatusChart();
            alert('导入成功');
          }
        } catch (error) {
          alert('导入失败: ' + error.message);
        }
      };
      reader.readAsArrayBuffer(file);

      // 重置文件输入，以便可以重复选择同一个文件
      e.target.value = '';
    }

    // 在页面加载时尝试导入Excel数据
    function importFromExcelOnLoad() {
      // 注意：由于浏览器安全限制，无法自动读取本地文件
      // 这里我们只是检查localStorage，如果为空，提示用户导入
      if (companies.length === 0) {
        // 不自动弹出提示，避免打扰用户
        console.log('没有找到本地数据，用户可以通过导入Excel按钮导入数据');
      }
    }
    
    // 关闭模态框
    function closeModal() {
      const modalContent = companyModal.querySelector('.modal-transition');
      modalContent.classList.remove('scale-100');
      modalContent.classList.add('scale-95');
      
      setTimeout(() => {
        companyModal.classList.add('hidden');
      }, 200);
    }
    
    // 保存公司信息
    function saveCompany() {
      const id = document.getElementById('companyId').value;
      const name = document.getElementById('companyName').value;
      const status = document.getElementById('status').value;
      const interviewTime = document.getElementById('interviewTime').value;
      const interviewLink = document.getElementById('interviewLink').value;
      const summary = document.getElementById('summary').value;
      const summaryLink = document.getElementById('summaryLink').value;
      
      const companyData = {
        name,
        status,
        interviewTime,
        interviewLink,
        summary,
        summaryLink
      };
      
      if (id) {
        // 更新现有公司
        const index = companies.findIndex(company => company.id === id);
        if (index !== -1) {
          companies[index] = { ...companies[index], ...companyData };
        }
      } else {
        // 添加新公司
        companies.push({
          id: Date.now().toString(),
          ...companyData,
          createdAt: new Date().toISOString()
        });
      }
      
      saveToLocalStorage();
      renderCompanyList();
      updateTotalCount();
      updateStatusChart();
      closeModal();
    }
    
    // 删除公司
    function deleteCompany(id) {
      if (confirm('确定要删除这条记录吗？')) {
        companies = companies.filter(company => company.id !== id);
        saveToLocalStorage();
        renderCompanyList();
        updateTotalCount();
        updateStatusChart();
      }
    }
    
    // 渲染公司列表
    function renderCompanyList() {
      // 筛选和排序
      let filteredCompanies = [...companies];
      
      // 筛选
      if (currentFilter !== 'all') {
        filteredCompanies = filteredCompanies.filter(company => company.status === currentFilter);
      }
      
      // 排序
      filteredCompanies.sort((a, b) => {
        // 没有面试时间的排在后面
        if (!a.interviewTime && !b.interviewTime) return 0;
        if (!a.interviewTime) return 1;
        if (!b.interviewTime) return -1;
        
        const dateA = new Date(a.interviewTime);
        const dateB = new Date(b.interviewTime);
        
        return sortOrder === 'asc' ? dateA - dateB : dateB - dateA;
      });
      
      // 清空列表
      companyListEl.innerHTML = '';
      
      // 没有数据时显示提示
      if (filteredCompanies.length === 0) {
        companyListEl.innerHTML = `
          <div class="col-span-full flex justify-center items-center py-16 text-gray-500">
            <div class="text-center">
              <i class="fa fa-search text-5xl mb-4 opacity-30"></i>
              <p>没有找到匹配的记录</p>
              ${currentFilter !== 'all' ? `<p class="mt-2">尝试选择"全部"筛选条件查看所有记录</p>` : ''}
            </div>
          </div>
        `;
        return;
      }
      
      // 渲染公司卡片
      filteredCompanies.forEach(company => {
        const card = document.createElement('div');
        card.className = 'bg-white rounded-xl shadow card-shadow card-hover overflow-hidden';
        card.innerHTML = `
          <div class="p-5">
            <div class="flex justify-between items-start mb-3">
              <h3 class="text-lg font-semibold text-gray-800">${company.name}</h3>
              <span class="px-2 py-1 text-xs font-medium rounded-full ${statusColorMap[company.status]} text-white">
                ${statusTextMap[company.status]}
              </span>
            </div>
            
            ${company.interviewTime ? `
              <div class="flex items-center text-gray-600 text-sm mb-2">
                <i class="fa fa-calendar mr-2 text-gray-400"></i>
                ${formatDateTime(company.interviewTime)}
              </div>
            ` : ''}
            
            ${company.interviewLink ? `
              <div class="flex items-center text-gray-600 text-sm mb-2">
                <i class="fa fa-link mr-2 text-gray-400"></i>
                <a href="${company.interviewLink}" target="_blank" class="text-primary hover:underline truncate max-w-[80%]">
                  ${getDomainFromUrl(company.interviewLink)}
                </a>
              </div>
            ` : ''}
            
            ${company.summary ? `
              <div class="text-gray-600 text-sm mb-2 line-clamp-2">
                <i class="fa fa-sticky-note-o mr-2 text-gray-400"></i>
                ${company.summary}
              </div>
            ` : ''}
            
            ${company.summaryLink ? `
              <div class="flex items-center text-gray-600 text-sm mb-2">
                <i class="fa fa-file-text-o mr-2 text-gray-400"></i>
                <a href="${company.summaryLink}" target="_blank" class="text-primary hover:underline truncate max-w-[80%]">
                  查看总结
                </a>
              </div>
            ` : ''}
            
            <div class="flex justify-end gap-2 mt-4 pt-3 border-t">
              <button class="edit-btn text-gray-500 hover:text-primary transition-all p-1" data-id="${company.id}">
                <i class="fa fa-pencil"></i> 编辑
              </button>
              <button class="delete-btn text-gray-500 hover:text-red-500 transition-all p-1" data-id="${company.id}">
                <i class="fa fa-trash-o"></i> 删除
              </button>
            </div>
          </div>
        `;
        
        companyListEl.appendChild(card);
        
        // 添加编辑和删除事件
        card.querySelector('.edit-btn').addEventListener('click', () => {
          const companyToEdit = companies.find(c => c.id === company.id);
          openModal(companyToEdit);
        });
        
        card.querySelector('.delete-btn').addEventListener('click', () => {
          deleteCompany(company.id);
        });
      });
    }
    
    // 保存到本地存储
    function saveToLocalStorage() {
      localStorage.setItem('autumnRecruitmentCompanies', JSON.stringify(companies));
      // 提示用户导出更新后的Excel
      // 为了不频繁打扰用户，可以添加一个延迟提示或仅在特定条件下提示
    }
    
    // 更新总数
    function updateTotalCount() {
      totalCountEl.textContent = companies.length;
    }
    
    // 初始化状态图表
    function initStatusChart() {
      const ctx = document.getElementById('statusChart').getContext('2d');
      
      // 准备数据
      const statusCounts = {
        'applied': 0,
        'interview1': 0,
        'interview2': 0,
        'interview3': 0,
        'interview4': 0,
        'hr': 0,
        'rejected': 0
      };
      
      companies.forEach(company => {
        if (statusCounts.hasOwnProperty(company.status)) {
          statusCounts[company.status]++;
        }
      });
      
      // 状态颜色值
      const statusColorValues = {
        'applied': '#60A5FA',
        'interview1': '#34D399',
        'interview2': '#10B981',
        'interview3': '#059669',
        'interview4': '#047857',
        'hr': '#F59E0B',
        'rejected': '#EF4444'
      };
      
      // 提取颜色和标签
      const backgroundColors = Object.keys(statusCounts).map(status => statusColorValues[status]);
      const labels = Object.keys(statusCounts).map(status => statusTextMap[status]);
      
      // 创建图表
      statusChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: labels,
          datasets: [{
            data: Object.values(statusCounts),
            backgroundColor: backgroundColors,
            borderWidth: 0,
            hoverOffset: 4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const label = context.label || '';
                  const value = context.raw || 0;
                  const total = context.dataset.data.reduce((a, b) => a + b, 0);
                  const percentage = total > 0 ? Math.round((value / total) * 100) : 0;
                  return `${label}: ${value} (${percentage}%)`;
                }
              }
            }
          },
          cutout: '70%',
          animation: {
            animateScale: true,
            animateRotate: true
          }
        }
      });
    }
    
    // 更新状态图表
    function updateStatusChart() {
      // 销毁现有图表
      if (statusChart) {
        statusChart.destroy();
      }
      
      // 重新初始化图表
      initStatusChart();
    }
    
    // 格式化日期时间
    function formatDateTime(dateTimeString) {
      if (!dateTimeString) return '';
      
      const date = new Date(dateTimeString);
      return date.toLocaleString('zh-CN', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit'
      });
    }
    
    // 从URL获取域名
    function getDomainFromUrl(url) {
      try {
        const urlObj = new URL(url);
        return urlObj.hostname.replace('www.', '');
      } catch (e) {
        return url;
      }
    }
    
    // 初始化应用
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>
